[phases.setup]
nixPkgs = ["python311"]

[phases.install]
cmds = ["python -m venv /opt/venv", ". /opt/venv/bin/activate && pip install --upgrade pip", ". /opt/venv/bin/activate && pip install -r backend/requirements.txt"]

[start]
cmd = ". /opt/venv/bin/activate && cd backend && echo 'Creating database tables...' && python -c 'from app.database import engine; from app.models import Base; print(\"Running Base.metadata.create_all...\"); Base.metadata.create_all(bind=engine); print(\"Tables created successfully!\")' && echo 'Starting uvicorn...' && uvicorn app.main:app --host 0.0.0.0 --port $PORT"
